---
title: "容器容灾备份"
date: "2022-10-26"
aliases: []
---

## 主要笔记
-  [[velero]] 是现行的 [[Kubernetes]] 集群[[异地灾备]]的主要选择，由 [[VMware]] 开发。
- [[容器]]备份容灾的功能的工作原理是
	- 用于存储[[容器镜像]]的数据（即[[PV]]）、[[Kubernetes]] 资源对象（即一系列 yaml 文件）的服务
		- 服务可以是 [[Minio]] 提供[[对象存储服务]]
			- 举例：[[本地磁盘]]由 [[carina]] 纳管提供的。
		- 也可以不上传，直接调 [[SC]] 对 [[PV]] 进行 [[Snapshot]]
- 在管理上提供了更多的工作机制，从 [[velero]] 可以梳理这些
	- 按需备份恢复
		- 例如，您可能需要告诉数据库在拍摄快照之前将其内存缓冲区刷新到磁盘。来保证[[应用一致性]]，三个一致性中（[[不一致性]]，[[崩溃一致性]]和[[应用一致性]]）
			- 在备份前对数据库进行 quiesce 操作，备份完 unquiesce。保证应用一致性，该点属于
	- 自动定期执行
	- 磁盘读写限速（避免影响业务）
	- 增量备份
	- 差异定制化选择
		- 解释一下：不同集群毕竟还是有不一样的地方，比如 NodePort 类型的 Service，本身就有随机性，是否要在恢复的时候恢复到新集群呢？提供一个参数来选择  `--preserve-nodeports`
- [[Kubernetes 容灾解决方案]]梳理以下要点
	- 备份粒度要到[[容器]]
	- 可以备份数据（即 [[PV]]）和配置（即一系列资源的 yaml）
	- 可以感知 [[Kubernetes]] 的[[命名空间]]
	- 适合[[多云]]和[[混合云]]环境
	- 保持[[应用一致性]]
		- 换句话说也要有应用这个层面的抽象，这可能需要结合 [[Kubevela]] 和 [[OAM]] 这样的工具
	- [[RTO]] 和 [[RPO]] 需求对应不同方案
		- 同步（例如：[[CDP]] ）与异步的方案影响
		- 网络状态（数据中心的地理位置）
		- 数据大小